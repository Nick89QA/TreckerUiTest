# E2E Selenide

### Описание:

Инструмент, предназначенный для автоматизации еnd-to-end тестирования для проекта https://hub.crtweb.ru основанный на фреймворках: TestNG, Selenide(Java/Selenium), BDD Cucumber(Gherkin) и Allure.

### Локальная настройка окружения

###### Для Mac OS
1. Необходимо установить XCode или Git. 
2. Необходимо перейти по ссылке, скачать и установить Amazon Corretto 8
   ```
    https://docs.aws.amazon.com/corretto/latest/corretto-8-ug/downloads-list.html
   ```
   - проверить работу OpenJDK 8: 
      ```
      java -version
      ``` 
3. Установить Maven (сборщик зависимостей)
     ```
    brew install maven
    ```
   - проверить работу Maven: 
     ```
     mvn -version
     ```  

    
4. Настроить переменные окружения для Allure (фреймворк для отчетов)
   Вместо userName необходимо указать имя вашего пользователя в системе.
    ```
    cd $home
    nano ~/.bash_profile
    в конец файла добавить:
    PATH=$PATH:/Users/userName/e2e-selenide/.allure/allure/bin
    ```
5. Необходимо обязательно перезапустить консоль/терминал.
    - проверить работу Allure: 
    ```
    allure --version
    ```

В случае если Allure при запуске выдаёт ошибку `Permission denied` то выполните следующее для файла Allure из папки bin:
    ```
    chmod +x allure
    ```

###### Для Ubuntu (Debian GNU/Linux)
1. Необходимо установить и настроить переменные окружения для OpenJDK 8 (основной стек)
    ```
    sudo apt install openjdk-8-jdk
   ```
   - добавить переменные окружения:
    ```
    export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
    export PATH=$PATH:$JAVA_HOME/bin
    ```
    - проверить работу переменных и OpenJDK 8: 
    ```
    echo $JAVA_HOME
    echo $PATH
    java -version
    ```
2. Установить Maven (сборщик зависимостей)
    ```
    sudo apt install maven
   ```
    - проверить работу Maven: 
    ```
    mvn -version
    ```
    
3. Настроить переменные окружения для Allure (фреймворк для отчетов)
   Вместо userName необходимо указать имя вашего пользователя в системе.
    ```
    cd $HOME
    nano .bashrc
    в конец файла добавить:
    export PATH=$PATH:/home/userName/e2e-selenide/.allure/allure/bin
    ```
4. Необходимо обязательно перезапустить консоль/терминал.
    - проверить работу Allure: 
    ```
    allure --version
    ```
###### Для Windows OS
1. Необходимо перейти по ссылке, скачать и установить Git for Windows
    ```
    https://git-scm.com/download/win
   ```
2. Необходимо перейти по ссылке, скачать и установить Amazon Corretto 8
   ```
    https://docs.aws.amazon.com/corretto/latest/corretto-8-ug/downloads-list.html
   ```
   переменные окружения будут настроены автоматически при установке, в случае если этого не произошло, то настроить их можно следующим образом:
   - Кликнуть правой кнопкой мыши на "мой компьютер" ->свойства->дополнительные параметры->переменные среды->системные переменные и далее:
   - Установить переменную `JAVA_HOME` как `C:\Program Files\Amazon Corretto\jdk1.8.0_252` (по умолчанию это путь установки Amazon Corretto 8) 
   - Добавить `%JAVA_HOME%\bin` в текущую переменную `PATH`.
   - проверить работу Amazon Corretto 8: 
   ```
   java -version
   ```
3. Необходимо перейти по ссылке, скачать и распаковать исполняемые файлы Maven в любую папку. Например: `C:\Program Files\apache-maven-3.6.3\`
    ```
    http://maven.apache.org/download.cgi
    ```
    добавить переменную окружения следующим образом:
    - Кликнуть правой кнопкой мыши на "мой компьютер" ->свойства->дополнительные параметры->переменные среды->системные переменные и далее:
    - Установить переменную `M2_HOME` как `C:\Program Files\apache-maven-3.6.3` (по умолчанию это путь распаковки Maven) 
    - Добавить `%M2_HOME%\bin` в текущую переменную `PATH`.
    - проверить работу Maven: 
    ```
    mvn -version
    ```

### Локальный запуск тестов

Перед запуском локальных тестов обязательно нужно убедиться в наличии установленных последних версий всех необходимых браузеров для тестирования.

###### Mac OS

1. Склонировать себе проект
  
2. Запустить терминал из корневой папки проекта и выполнить команду: 
    ```
    ./start_local.sh
    ```
3. Следовать подсказкам терминальной программы.

###### Для Ubuntu (Debian GNU/Linux)

1. Склонировать себе проект 
  

2. Запустить терминал из корневой папки проекта и выполнить команду: 
    ```
    ./start_local.sh
    ```
3. Следовать подсказкам терминальной программы.

###### Для Windows OS

1. Склонировать себе проект

2. Запустить терминал с помощью правой кнопки мыши на "Git Bash Here" из корневой папки проекта и выполнить команду: 
    ```
    ./start_local.sh
    ```
3. Следовать подсказкам терминальной программы. Первый запуск теста возможно будет чуть дольше чем все последующие из-за скачивания большого числа зависимостей.



###### Запуск тестов на Safari из под Mac OS

Для успешного запуска тестов на Safari, необходимо сначала перейти в сам Safari - Разработка - Разрешить удалённую автоматизацию.

###### Просмотр Allure отчета для Windows OS
1.Прописать данную команду в терминале  IDEA 

```
allure serve target/allure-results
```
Запуск тестов из под Docker
Mac OS
Склонировать себе проект

Скопировать .env файл из .env.example (прописать все IP адреса планет и хабов если они не актуальны)

Скопировать config.properties файл из config.properties.example (прописать настройки доступы TestRail)

Запустить терминал из корневой папки проекта и выполнить команду:

./start_docker.sh
Следовать подсказкам терминальной программы.

Если случайно произошел выход из терминальной программы - не обязательно снова перезапускать сборку контейнера, достаточно запустить файл: ./return_docker.sh

Для Ubuntu (Debian GNU/Linux)
Склонировать себе проект

Скопировать .env файл из .env.example (прописать все IP адреса планет и хабов если они не актуальны)

Узнать и прописать IP локальной машины можно командой:

 ifconfig | grep -E "([0-9]{1,3}\.){3}[0-9]{1,3}" | grep -v 127.0.0.1 | awk '{ print $2 }' | cut -f2 -d: | head -n1
либо отредактировать следующую команду в файле start_docker.sh и IP будет автоматически обновлен при запуске (только для систем на которых установлен ifconfig):

 export LOCALHOST_IP=$(ifconfig | grep -E "([0-9]{1,3}\.){3}[0-9]{1,3}" | grep -v 127.0.0.1 | awk '{ print $2 }' | cut -f2 -d: | head -n1)
Скопировать config.properties файл из config.properties.example (прописать настройки доступы TestRail)

Запустить терминал из корневой папки проекта и выполнить команду:

./start_docker.sh
Следовать подсказкам терминальной программы.

Если после запуска тестов в SeleniumHub программа выводит ошибку "Не найден SeleniumHub", то необходимо заново перезапустить программу и на экране приветствия необходимо включить возможность пересылки пакетов в основной системе, для этого необходимо выполнить в отдельном терминале:

sudo su
sysctl net.ipv4.ip_forward=1
iptables -D ciscovpn  -i cscotun0 -j DROP && iptables -D ciscovpn -o cscotun0 -j DROP
После чего продолжить запуск тестов.

Если случайно произошел выход из терминальной программы - не обязательно снова перезапускать сборку контейнера, достаточно запустить файл: ./return_docker.sh

Для Windows OS
Склонировать себе проект

Скопировать .env файл из .env.example (прописать все IP адреса планет и хабов если они не актуальны)

Скопировать config.properties файл из config.properties.example (прописать настройки доступы TestRail)

Запустить терминал с помощью правой кнопки мыши на "Git Bash Here" из корневой папки проекта и выполнить команду:

./start_docker.sh
Следовать подсказкам терминальной программы.

Если случайно произошел выход из терминальной программы - не обязательно снова перезапускать сборку контейнера, достаточно запустить файл: ./return_docker.sh

При возникновении ошибки "standard_init_linux.go:211: exec user process caused "no such file or directory" необходимо выполнить команду в Git bash: dos2unix.exe start_local.sh либо переключить формат для всех sh файлов с CRLF на LF и сохранить их.
